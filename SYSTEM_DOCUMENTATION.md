# üìö CRMS6-IT System Documentation

> **Computer Room Management System - Tessaban 6 IT Department**  
> **‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤**  
> **Last Updated:** 24 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2567 (‡πÄ‡∏ß‡∏•‡∏≤ 11:30) | **Version:** 1.5.0

---

## üìã ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç

1. [‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö](#-‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö)
2. [‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ](#-‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ)
3. [‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ](#-‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ)
4. [‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î](#-‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
5. [AI Agent (LINE Bot)](#-ai-agent-line-bot)
6. [‡∏£‡∏∞‡∏ö‡∏ö Authentication](#-‡∏£‡∏∞‡∏ö‡∏ö-authentication)
7. [API Routes](#-api-routes)
8. [Database Schema](#-database-schema-firestore)
9. [Utility Libraries](#-utility-libraries)
10. [Environment Variables](#-environment-variables)
11. [‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠](#-‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠)
12. [Known Issues & TODOs](#-known-issues--todos)

---

## üéØ ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö

CRMS6-IT ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢:

| ‡πÇ‡∏°‡∏î‡∏π‡∏• | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|-------|---------|
| **‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°** | ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå, ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞, ‡∏ä‡πà‡∏≤‡∏á‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô |
| **‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á** | ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°/‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô, ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô, ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ |
| **‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°** | ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û, ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î Google Drive |
| **‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå** | ‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå, QR Code, Stock Management |
| **Gallery** | ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° |
| **LINE Integration** | ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE, LIFF Apps |
| **AI Agent** | ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ AI ‡πÉ‡∏ô LINE Bot (Gemini 2.5 Flash) |

---

## üõ† ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ

### Frontend
| Technology | Version | Purpose |
|------------|---------|---------|
| Next.js | 14.1.0 | React Framework (App Router) |
| React | 18.x | UI Library |
| TypeScript | 5.x | Type Safety |
| TailwindCSS | 3.3.0 | Styling |
| Framer Motion | 12.x | Animations |
| Lucide React | 0.555 | Icons |

### Backend
| Technology | Purpose |
|------------|---------|
| Next.js API Routes | Server-side APIs |
| Firebase Admin SDK | Server-side Firestore (AI Agent, OTP) |
| Nodemailer | Email OTP Service |

### Database & Storage
| Service | Purpose |
|---------|---------|
| Firebase Firestore | NoSQL Database |
| Firebase Storage | Image Storage |
| Google Drive API | Photo Upload |

### Authentication
| Service | Purpose |
|---------|---------|
| Firebase Auth | Google Sign-In |
| LINE LIFF | LINE Login |

### Notifications
| Service | Purpose |
|---------|---------|
| LINE Messaging API | Push Messages |
| LINE Bot SDK | Webhook Handling |

### Other Libraries
```json
{
  "react-big-calendar": "Calendar Component",
  "moment": "Date Handling",
  "react-hot-toast": "Toast Notifications",
  "html2canvas + jspdf": "PDF Generation",
  "xlsx": "Excel Export",
  "jszip": "File Compression",
  "react-signature-canvas": "Digital Signature"
}
```

---

## üìÅ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ

```
crms6it/
‚îú‚îÄ‚îÄ app/                          # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ api/                      # API Routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/                 # LINE Custom Token
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ drive/upload/         # Google Drive Upload
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ line/                 # LINE Login/Callback/Push
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ line-webhook/         # LINE Bot Webhook
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notify-repair/        # Notify Technicians
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ notify-user/          # Notify Users
‚îÇ   ‚îú‚îÄ‚îÄ admin/                    # Admin Pages
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ add-product/          # ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bookings/             # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inventory/            # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repairs/              # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users/                # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
‚îÇ   ‚îú‚îÄ‚îÄ booking/                  # ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á
‚îÇ   ‚îú‚îÄ‚îÄ gallery/                  # ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
‚îÇ   ‚îú‚îÄ‚îÄ liff/                     # LINE LIFF Pages
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ booking/              # LIFF ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entry/                # LIFF Entry Point
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repair/               # LIFF ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°
‚îÇ   ‚îú‚îÄ‚îÄ login/                    # ‡∏´‡∏ô‡πâ‡∏≤ Login
‚îÇ   ‚îú‚îÄ‚îÄ product/[id]/             # ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
‚îÇ   ‚îú‚îÄ‚îÄ profile/                  # ‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
‚îÇ   ‚îú‚îÄ‚îÄ repair/                   # ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°
‚îÇ   ‚îú‚îÄ‚îÄ components/               # React Components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/            # Dashboard Widgets
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ liff/                 # LIFF Components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ navigation/           # Navigation (TopHeader, BottomNav, etc.)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repairs/              # Repair Components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ shared/               # Shared Components
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui/                   # UI Components
‚îÇ   ‚îú‚îÄ‚îÄ globals.css               # Global Styles
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                # Root Layout
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx                  # Dashboard (Home)
‚îú‚îÄ‚îÄ components/                   # Legacy Components
‚îú‚îÄ‚îÄ context/                      # React Contexts
‚îÇ   ‚îú‚îÄ‚îÄ AuthContext.tsx           # Authentication Context
‚îÇ   ‚îî‚îÄ‚îÄ ThemeContext.tsx          # Dark/Light Mode
‚îú‚îÄ‚îÄ hooks/                        # Custom React Hooks
‚îÇ   ‚îú‚îÄ‚îÄ useActivityLogs.ts        # Activity Logs
‚îÇ   ‚îú‚îÄ‚îÄ useBookings.ts            # Bookings CRUD
‚îÇ   ‚îú‚îÄ‚îÄ useInventory.ts           # Inventory CRUD
‚îÇ   ‚îú‚îÄ‚îÄ useLiff.ts                # LINE LIFF
‚îÇ   ‚îú‚îÄ‚îÄ usePagination.ts          # Pagination Helper
‚îÇ   ‚îú‚îÄ‚îÄ useRepairAdmin.ts         # Repair Admin (Stats, CRUD)
‚îÇ   ‚îú‚îÄ‚îÄ useRepairTickets.ts       # Repair Tickets
‚îÇ   ‚îî‚îÄ‚îÄ useSessionTimeout.ts      # Auto Logout
‚îú‚îÄ‚îÄ lib/                          # Utility Libraries
‚îÇ   ‚îú‚îÄ‚îÄ academicYear.ts           # Thai Academic Year Helper
‚îÇ   ‚îú‚îÄ‚îÄ firebase.ts               # Firebase Client Init
‚îÇ   ‚îú‚îÄ‚îÄ firebaseAdmin.ts          # Firebase Admin Init
‚îÇ   ‚îú‚îÄ‚îÄ generateReport.ts         # PDF Report Generator
‚îÇ   ‚îî‚îÄ‚îÄ googleDrive.ts            # Google Drive Upload
‚îú‚îÄ‚îÄ types/                        # TypeScript Types
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                  # All Type Definitions
‚îú‚îÄ‚îÄ utils/                        # Utility Functions
‚îÇ   ‚îú‚îÄ‚îÄ aggregation.ts            # Inventory Stats (/stats/inventory)
‚îÇ   ‚îú‚îÄ‚îÄ excelExport.ts            # Excel Export (Repair Reports)
‚îÇ   ‚îú‚îÄ‚îÄ flexMessageTemplates.ts   # LINE Flex Message Templates
‚îÇ   ‚îú‚îÄ‚îÄ imageCompression.ts       # Client-side Image Compression
‚îÇ   ‚îî‚îÄ‚îÄ logger.ts                 # Activity Logging
‚îú‚îÄ‚îÄ public/                       # Static Assets
‚îî‚îÄ‚îÄ SYSTEM_DOCUMENTATION.md       # This File
```

---

## ‚ú® ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

### 1. üîß ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° (Repair System)

| ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|---------|---------|
| ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° | ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û |
| ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ã‡∏ô | ‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏ï‡πâ‡∏ô / ‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏õ‡∏•‡∏≤‡∏¢ |
| ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô LINE | ‡∏ä‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÇ‡∏ã‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô |
| ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô | ‡∏ä‡πà‡∏≤‡∏á‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ |
| ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà | ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ã‡πà‡∏≠‡∏° |
| ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | ‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤ |
| ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | pending, in_progress, waiting_parts, completed, cancelled |

### 2. üìÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á (Booking System)

| ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|---------|---------|
| ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á | ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ |
| ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ | Calendar + Time Picker |
| ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ã‡πâ‡∏≠‡∏ô | ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ã‡πâ‡∏≥ |
| ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ | Admin/Moderator ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á |
| ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô | ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô |
| LIFF | ‡∏à‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô LINE ‡πÑ‡∏î‡πâ |

### 3. üì∏ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (Photography Job System)

| ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|---------|---------|
| ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô | Admin ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô) |
| ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô | ‡∏ä‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏û‡∏£‡πâ‡∏≠‡∏° Flex Message ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° |
| ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û | ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏õ Google Drive |
| ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå | ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ > ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô > ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô > ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° |
| ‡∏†‡∏≤‡∏û‡∏õ‡∏Å | ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡∏õ‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Gallery |
| Compress | ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏†‡∏≤‡∏û‡∏õ‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î Firebase |
| My Jobs Modal | ‡∏ä‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á + ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ |
| Manual Entry | ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á |
| Booking Integration | ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å `bookingId`) |
| **Facebook Auto Post** | ‡πÇ‡∏û‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏õ Facebook Page ‡∏ú‡πà‡∏≤‡∏ô URL-based upload |
| **‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏†‡∏≤‡∏û Facebook** | ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÇ‡∏û‡∏™ (1, 2, 3...) |
| **Shift+Click Selection** | ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏î‡πâ‡∏ß‡∏¢ Shift+Click |

### 4. üñºÔ∏è Gallery (‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°)

| ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|---------|---------|
| ‡πÅ‡∏™‡∏î‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à | ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà status = completed |
| ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ | ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°, ‡∏ä‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà |
| ‡∏Å‡∏£‡∏≠‡∏á | ‡∏ß‡∏±‡∏ô, ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô, ‡∏õ‡∏µ (‡∏û.‡∏®.) |
| Pagination | 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ |
| **Drive Icon** | ‡∏Å‡∏î‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô Google Drive ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏†‡∏≤‡∏û |
| **Facebook Icon** | ‡∏Å‡∏î‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô Facebook ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏û‡∏™‡∏ï‡πå (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) |

### 5. üì¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (Inventory System)

| ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|---------|---------|
| ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏° QR Code ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ |
| ‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô | ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô |
| ‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå | Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô + ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ |
| ‡πÄ‡∏ö‡∏¥‡∏Å | ‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ñ‡∏≤‡∏ß‡∏£ |
| ‡∏™‡πÅ‡∏Å‡∏ô QR | ‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
| ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ | ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå |
| User History | ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á (‡∏ã‡πà‡∏≠‡∏°, ‡∏à‡∏≠‡∏á, ‡∏¢‡∏∑‡∏°, ‡πÄ‡∏ö‡∏¥‡∏Å) |
| Stats Aggregation | ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏ö‡∏ö Realtime (available, borrowed, maintenance) |

### 6. üë• ‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (User Management)

| Role | ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå |
|------|-------|
| `user` | ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°, ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á, ‡∏î‡∏π Gallery |
| `technician` | + ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏° |
| `moderator` | + ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á, ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û |
| `admin` | + ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á, ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ |
| `isPhotographer` | Flag ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û (‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö role) |

### 7. üîî LINE Integration

| ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|---------|---------|
| LINE Login | ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ LINE ‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö |
| LIFF Apps | ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°/‡∏à‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô LINE |
| Push Notification | ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE |
| Rich Menu | Track Status, ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏° |
| Flex Message Templates | ‡∏£‡∏∞‡∏ö‡∏ö Template ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö: ‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà, ‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à, ‡∏á‡∏≤‡∏ô‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û, Status Carousel |

#### Flex Message Templates (`utils/flexMessageTemplates.ts`)
| Template | Purpose |
|----------|---------|
| `createRepairNewFlexMessage` | ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà |
| `createRepairCompleteFlexMessage` | ‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à |
| `createPhotographyFlexMessage` | ‡πÅ‡∏à‡πâ‡∏á‡∏ä‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô |
| `createStatusBubble` | ‡∏™‡∏£‡πâ‡∏≤‡∏á Status Card ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Carousel |

### 8. üéõÔ∏è Admin Dashboard

| ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|---------|---------|
| Overview | ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°, ‡∏à‡∏≠‡∏á, ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û, ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå) |
| Quick Stats | ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏ö‡∏ö Realtime ‡∏û‡∏£‡πâ‡∏≠‡∏° Link ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ |
| Activity Feed | ‡πÅ‡∏™‡∏î‡∏á Activity Logs ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î |
| Quick Links | ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏•‡∏±‡∏î‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≤‡∏á‡πÜ |
| Admin Navigation | ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin/Moderator |

### 9. ‚öôÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö Feedback / Report Issue

| ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|---------|---------|
| Report Issue Modal | ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô) |
| Feedback Collection | ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á `feedbacks` collection |
| Success Animation | ‡πÅ‡∏™‡∏î‡∏á Animation ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à |

### 10. üß≠ Navigation & UI Components

#### Navigation Components (`app/components/navigation/`)
| Component | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|-----------|---------|
| `TopHeader` | Header ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÇ‡∏•‡πÇ‡∏Å‡πâ, Search, User Profile |
| `BottomNavigation` | Navigation ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Mobile + Quick Actions Menu |
| `CommandPalette` | ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏ß‡∏¢ Keyboard Shortcut (‚åòK / Ctrl+K) |
| `SideQuickAccess` | Floating Quick Actions ‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á |

#### Dashboard Components (`app/components/dashboard/`)
| Component | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|-----------|---------|
| `CalendarSection` | ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° |
| `ActivityFeed` | ‡πÅ‡∏™‡∏î‡∏á Activity Logs ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î |
| `QuickActions` | ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Actions ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡πà‡∏≠‡∏¢ |

#### Modal Components (`app/components/`)
| Component | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|-----------|---------|
| `ReportIssueModal` | ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô |
| `ReturnModal` | ‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô |
| `UserHistoryModal` | ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (‡∏ã‡πà‡∏≠‡∏°, ‡∏à‡∏≠‡∏á, ‡∏¢‡∏∑‡∏°, ‡πÄ‡∏ö‡∏¥‡∏Å) |
| `MyPhotographyJobsModal` | ‡∏ä‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏î‡∏π‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏á‡∏≤‡∏ô |
| `BookingDetailsModal` | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á |
| `ConfirmationModal` | Modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥ |

### 11. üõ†Ô∏è Utility Functions

#### Image Compression (`utils/imageCompression.ts`)
| Function | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|----------|---------|
| `compressImage` | ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏ß‡∏¢ Canvas API |
| `compressImageToSize` | ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ |

**Options:**
- `maxWidth`: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (default: 1920)
- `maxHeight`: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (default: 1080)
- `quality`: ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û 0-1 (default: 0.8)
- `maxSizeMB`: ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î MB (default: 1)

#### Stats Aggregation (`utils/aggregation.ts`)
| Function | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|----------|---------|
| `incrementStats` | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ |
| `decrementStats` | ‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ |
| `updateStatsOnStatusChange` | ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ |

**Collection:** `stats/inventory`

#### Activity Logger (`utils/logger.ts`)
| Parameter | Type | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|-----------|------|---------|
| `action` | LogAction | borrow, return, requisition, add, update, repair, etc. |
| `productName` | string | ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ |
| `userName` | string | ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ |
| `details` | string? | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° |
| `signatureUrl` | string? | URL ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô |

#### Excel Export (`utils/excelExport.ts`)
| Function | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|----------|---------|
| `exportToExcel` | Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏õ‡πá‡∏ô Excel (.xlsx) |

**Columns:** ‡∏•‡∏≥‡∏î‡∏±‡∏ö, ‡∏ß‡∏±‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á, ‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á, ‡∏õ‡∏±‡∏ç‡∏´‡∏≤/‡∏≠‡∏≤‡∏Å‡∏≤‡∏£, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞

---

## ü§ñ AI Agent (LINE Bot)

‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ù‡πà‡∏≤‡∏¢‡πÇ‡∏™‡∏ï‡∏ó‡∏±‡∏®‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÉ‡∏ô LINE Bot ‡πÉ‡∏ä‡πâ **Google Gemini 2.5 Flash** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏†‡∏≤‡∏©‡∏≤‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥

### Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   LINE Bot      ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   aiAgent.ts     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  agentFunctions ‚îÇ
‚îÇ   Webhook       ‚îÇ    ‚îÇ  (Main Processor) ‚îÇ    ‚îÇ    .ts          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ  gemini.ts  ‚îÇ
                       ‚îÇ (AI Config) ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Files Overview

| File | Lines | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|------|-------|----------|
| `lib/gemini.ts` | 178 | AI configuration, system prompt, safety settings |
| `lib/aiAgent.ts` | 700+ | Main processor, context management, intent handlers (Admin SDK) |
| `lib/agentFunctions.ts` | 628 | Database functions via Admin SDK, mappings, data formatting |
| `lib/emailService.ts` | 85 | Email OTP service using Nodemailer |

---

### üìÅ `lib/gemini.ts` - AI Configuration

**Model:** `gemini-2.5-flash`

**Settings:**
| Setting | Value |
|---------|-------|
| Temperature | 0.4 (text) / 0.5 (vision) |
| Max Tokens | 2048 (text) / 1024 (vision) |
| Safety | Block Medium and Above |

**Main Exports:**
- `geminiModel` - Text chat model
- `geminiVisionModel` - Image analysis model
- `AI_SYSTEM_PROMPT` - ‡∏£‡∏∞‡∏ö‡∏ö prompt ‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á AI
- `startAIChat()` - ‡∏™‡∏£‡πâ‡∏≤‡∏á chat session ‡∏û‡∏£‡πâ‡∏≠‡∏° system prompt
- `imageToGenerativePart()` - ‡πÅ‡∏õ‡∏•‡∏á image buffer ‡πÄ‡∏õ‡πá‡∏ô Gemini format

**System Prompt Features:**
1. ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ Markdown (‡∏´‡πâ‡∏≤‡∏° **bold**, -, bullet)
2. ‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô JSON Minified ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (function calling)
3. ‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ "‡∏Ñ‡πà‡∏∞" / "‡∏ô‡∏∞‡∏Ñ‡∏∞"
4. ‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô Room ID ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
5. ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ", "‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ" ‚Üí "today", "tomorrow"

---

### üìÅ `lib/aiAgent.ts` - Main Processor

#### Configuration Constants
```typescript
CONTEXT_EXPIRY_MINUTES = 30  // ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ 30 ‡∏ô‡∏≤‡∏ó‡∏µ
MAX_CONTEXT_MESSAGES = 10    // ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
```

#### Types & Interfaces

```typescript
interface ConversationContext {
    messages: { role: 'user' | 'model'; content: string; timestamp: Date }[];
    pendingAction?: {
        intent: string;
        params: Record<string, any>;
        repairStep?: 'awaiting_symptom' | 'awaiting_image' | 'awaiting_intent_confirm' 
                   | 'awaiting_room' | 'awaiting_side' | 'awaiting_final_confirm'
                   | 'awaiting_link_email' | 'awaiting_otp';  // OTP Account Binding
        galleryResults?: any[];
    };
    lastActivity: any;
}

interface AIResponse {
    intent?: string;
    params?: Record<string, unknown>;
    execute?: boolean;
    message?: string;
}
```

#### Context Management Functions
| Function | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|----------|----------|
| `getConversationContext(lineUserId)` | ‡∏î‡∏∂‡∏á context ‡∏à‡∏≤‡∏Å Firestore (‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ 30 ‡∏ô‡∏≤‡∏ó‡∏µ) |
| `saveConversationContext(lineUserId, context)` | ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å context (trim ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 10 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°) |
| `clearPendingAction(lineUserId)` | ‡∏•‡πâ‡∏≤‡∏á pending action |

#### User Profile Functions
| Function | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|----------|----------|
| `getUserProfileFromLineBinding(lineUserId)` | ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ user ‡∏à‡∏≤‡∏Å `line_bindings` ‡∏´‡∏£‡∏∑‡∏≠ `users.lineUserId` |

Returns: `UserProfile { uid, displayName, email, role, isPhotographer, responsibility }`

#### Intent Handlers

| Function | Intent | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|----------|--------|----------|
| `handleCheckRepair()` | CHECK_REPAIR | ‡∏î‡∏∂‡∏á‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏Ç‡∏≠‡∏á user ‡∏´‡∏£‡∏∑‡∏≠ ticketId |
| `handleCheckAvailability()` | CHECK_AVAILABILITY | ‡πÄ‡∏ä‡πá‡∏Ñ‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á |
| `handleRoomSchedule()` | CHECK_ROOM_SCHEDULE | ‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô |
| `handleMyWork()` | MY_WORK | ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô (‡πÅ‡∏ö‡πà‡∏á‡∏ï‡∏≤‡∏° role) |
| `handleGallerySearchWithResults()` | GALLERY_SEARCH | ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏π‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° + ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡∏π‡∏•‡∏¥‡∏á‡∏Å‡πå |
| `handleDailySummary()` | DAILY_SUMMARY | ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô |
| `handleBookRoom()` | BOOK_ROOM | [RESERVED] ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô intercept ‡πÑ‡∏õ‡πÄ‡∏ß‡πá‡∏ö) |

#### MY_WORK Logic (‡∏ï‡∏≤‡∏° Role)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ MY_WORK     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ
      ‚îú‚îÄ‚îÄ technician ‚Üí getRepairsForTechnician(zone)
      ‚îÇ
      ‚îú‚îÄ‚îÄ isPhotographer ‚Üí getPhotoJobsByPhotographer(uid)
      ‚îÇ
      ‚îú‚îÄ‚îÄ moderator/admin ‚Üí getPendingBookings()
      ‚îÇ
      ‚îî‚îÄ‚îÄ user ‚Üí getBookingsByEmail(email)
```

#### Room Schedule Format
```
üìÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á ‡∏´‡πâ‡∏≠‡∏á‡∏•‡∏µ‡∏•‡∏≤‡∏ß‡∏î‡∏µ (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)

(‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ) 09:00 - 12:00
‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Ñ‡∏£‡∏π‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞
‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á ‡∏≠.‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ
```

#### Multi-Step Repair Flow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ User: "‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏Ñ‡∏≠‡∏°"                                                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Step 1: awaiting_symptom ‚Üí "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏Ñ‡∏∞?"                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ User: "‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î"                                                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Step 2: awaiting_image ‚Üí "‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏°‡∏≤‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞? (‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏≠‡∏ö '‡πÑ‡∏°‡πà‡∏°‡∏µ')"          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ User: [‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ] ‚Üí analyzeRepairImage()                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Step 3: awaiting_intent_confirm ‚Üí "[AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏π‡∏õ] ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞?"  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ User: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô"                                                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Step 4: awaiting_room ‚Üí "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà/‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏∞?"            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ User: "‡∏´‡πâ‡∏≠‡∏á 401"                                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Step 5: awaiting_side ‚Üí "‡∏≠‡∏¢‡∏π‡πà‡∏ù‡∏±‡πà‡∏á ‡∏°.‡∏ï‡πâ‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡∏°.‡∏õ‡∏•‡∏≤‡∏¢ ‡∏Ñ‡∏∞?"              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ User: "‡∏°.‡∏õ‡∏•‡∏≤‡∏¢"                                                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Step 6: Final Confirm ‚Üí "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ... ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞?"            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ User: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô" ‚Üí createRepairFromAI() ‚Üí ‚úÖ ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Main Entry Point

```typescript
processAIMessage(lineUserId, userMessage, imageBuffer?, imageMimeType?)
```

**Flow:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö "‡∏ú‡∏π‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ" keyword ‚Üí ‡πÄ‡∏£‡∏¥‡πà‡∏° OTP Flow
2. Intercept "‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á" ‚Üí redirect ‡πÑ‡∏õ‡πÄ‡∏ß‡πá‡∏ö
3. ‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‚Üí analyzeRepairImage() ‡∏´‡∏£‡∏∑‡∏≠ process repair step
4. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ pending actions (multi-step) ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á OTP verification
5. ‡∏™‡πà‡∏á‡πÑ‡∏õ Gemini AI ‚Üí parse JSON response
6. Execute intent handler ‡∏ï‡∏≤‡∏° response

#### OTP Account Binding Flow (NEW)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ User: "‡∏ú‡∏π‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ"                                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ AI: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå email @tesaban6.ac.th ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏∞                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Step: awaiting_link_email                                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ User: kawin@tesaban6.ac.th                                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ AI: ‚úâÔ∏è ‡∏™‡πà‡∏á‡∏£‡∏´‡∏±‡∏™ OTP 6 ‡∏´‡∏•‡∏±‡∏Å‡πÑ‡∏õ‡∏ó‡∏µ‡πà email ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Step: awaiting_otp                                                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ User: 482719                                                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ AI: ‚úÖ ‡∏ú‡∏π‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏Ñ‡πà‡∏∞! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏ß‡∏¥‡∏ô                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**OTP Constraints:**
- Email ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ `@tesaban6.ac.th` ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- OTP ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ô 5 ‡∏ô‡∏≤‡∏ó‡∏µ
- ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á

---

### üìÅ `lib/agentFunctions.ts` - Database Functions (Admin SDK)

> ‚ö†Ô∏è **‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ Firebase Admin SDK (`adminDb`) ‡πÅ‡∏ó‡∏ô Client SDK ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û

#### Mappings

**ROOM_MAPPING (‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ó‡∏¢ ‚Üí Room ID):**
```typescript
'‡∏´‡πâ‡∏≠‡∏á‡∏•‡∏µ‡∏•‡∏≤‡∏ß‡∏î‡∏µ': 'sh_leelawadee'
'‡∏•‡∏µ‡∏•‡∏≤‡∏ß‡∏î‡∏µ': 'sh_leelawadee'
'‡∏•‡∏µ‡∏•‡∏≤': 'sh_leelawadee'
'‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏ç‡∏≤‡∏™‡∏±‡∏ï‡∏ö‡∏£‡∏£‡∏ì': 'jh_phaya'
'‡∏û‡∏ç‡∏≤‡∏™‡∏±‡∏ï‡∏ö‡∏£‡∏£‡∏ì': 'jh_phaya'
'‡∏û‡∏ç‡∏≤': 'jh_phaya'
'‡∏´‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°': 'sh_auditorium'
'‡∏´‡πâ‡∏≠‡∏á‡∏à‡∏≤‡∏°‡∏à‡∏∏‡∏£‡∏µ': 'jh_chamchuri'
// ... ‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ
```

**ROOM_NAME_DISPLAY (Room ID ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ó‡∏¢‡∏™‡∏ß‡∏¢):**
```typescript
'jh_phaya': '‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏ç‡∏≤‡∏™‡∏±‡∏ï‡∏ö‡∏£‡∏£‡∏ì (‡∏°.‡∏ï‡πâ‡∏ô)'
'sh_leelawadee': '‡∏´‡πâ‡∏≠‡∏á‡∏•‡∏µ‡∏•‡∏≤‡∏ß‡∏î‡∏µ (‡∏°.‡∏õ‡∏•‡∏≤‡∏¢)'
// ... ‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ
```

**SIDE_MAPPING (‡πÇ‡∏ã‡∏ô):**
```typescript
'‡∏°.‡∏ï‡πâ‡∏ô': 'junior_high'
'‡∏°.‡∏õ‡∏•‡∏≤‡∏¢': 'senior_high'
'‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á': 'common'
```

#### Helper Functions
| Function | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|----------|----------|
| `getRoomDisplayName(id)` | ‡πÅ‡∏õ‡∏•‡∏á Room ID ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ó‡∏¢ |
| `formatToThaiTime(date)` | ‡πÅ‡∏õ‡∏•‡∏á Timestamp ‚Üí "22 ‡∏ò.‡∏Ñ. 2568 ‡πÄ‡∏ß‡∏•‡∏≤ 14:30 ‡∏ô." |
| `getThaiDateRange(dateStr)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á Firestore Timestamp range (UTC+7) |

#### Database Functions

**Gallery & Photography:**
| Function | Output | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|----------|--------|----------|
| `searchGallery(keyword?, date?)` | Formatted[] | ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ completed jobs |
| `getPhotoJobsByPhotographer(userId, date?)` | Formatted[] | ‡∏á‡∏≤‡∏ô‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏ä‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û |

**Repair:**
| Function | Output | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|----------|--------|----------|
| `createRepairFromAI(...)` | CreateRepairResult | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° + notify ‡∏ä‡πà‡∏≤‡∏á |
| `getRepairsByEmail(email)` | Formatted[] | ‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏Ç‡∏≠‡∏á user (5 ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î) |
| `getRepairsForTechnician(zone, date?)` | RepairTicket[] | ‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á (raw data) |
| `getRepairByTicketId(ticketId)` | RepairTicket | ‡∏î‡∏∂‡∏á‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏° ID |

**Booking:**
| Function | Output | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|----------|--------|----------|
| `checkRoomAvailability(room, date, start, end)` | CheckAvailabilityResult | ‡πÄ‡∏ä‡πá‡∏Ñ‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á |
| `getRoomSchedule(room, date)` | Formatted[] | ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° (‡πÄ‡∏ß‡∏•‡∏≤ HH:mm) |
| `createBookingFromAI(...)` | BookingResult | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á |
| `getBookingsByEmail(email)` | Formatted[] | ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á user |
| `getPendingBookings(date?)` | Formatted[] | ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ |

**Summary:**
| Function | Output | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|----------|--------|----------|
| `getDailySummary()` | SummaryObject | ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô |

---

### Image Analysis (Vision)

```typescript
analyzeRepairImage(imageBuffer, mimeType, symptomDescription)
```

**Prompt Features:**
1. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå IT/‡πÇ‡∏™‡∏ï‡∏Ø
2. ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô 2-3 ‡∏Ç‡πâ‡∏≠
3. ‡∏ñ‡∏≤‡∏° "‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞?"
4. ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‚Üí ‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏†‡∏≤‡∏û

---

### Database Collections (AI-related)

**`ai_conversations`** - Context Storage
```typescript
{
  messages: [{ role, content, timestamp }],
  pendingAction: { intent, params, repairStep?, galleryResults? },
  lastActivity: Timestamp
}
```

**Document ID:** LINE User ID
**Expiry:** 30 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å lastActivity

---

## üîê ‡∏£‡∏∞‡∏ö‡∏ö Authentication

### Flow
```
1. User clicks "Login with Google"
2. Firebase Auth (signInWithPopup)
3. Check email domain (@tesaban6.ac.th only)
4. Fetch/Create user doc in Firestore
5. Setup realtime listener for role & isPhotographer
6. Role-based UI rendering
```

### AuthContext (`context/AuthContext.tsx`)
```typescript
interface AuthContextType {
    user: User | null;           // Firebase User
    role: UserRole | null;       // user | technician | moderator | admin
    isPhotographer: boolean;     // Photographer flag
    loading: boolean;
    signInWithGoogle: () => Promise<void>;
    signOut: () => Promise<void>;
}
```

### Realtime Updates
- ‡πÉ‡∏ä‡πâ `onSnapshot()` ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° user document
- Admin ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô role/isPhotographer ‚Üí User ‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á logout/login ‡πÉ‡∏´‡∏°‡πà

---

## üåê API Routes

---

### üìÅ `/api/drive/upload` (POST) - Google Drive Upload

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:** ‡πÉ‡∏ä‡πâ **Resumable Upload** - API ‡∏Ñ‡∏∑‡∏ô URL ‡πÉ‡∏´‡πâ client ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Drive

**Request:**
```json
{
  "fileName": "IMG_001.jpg",
  "mimeType": "image/jpeg",
  "eventName": "‡∏Å‡∏µ‡∏¨‡∏≤‡∏™‡∏µ 2567",
  "jobDate": "2024-12-22T00:00:00.000Z"
}
```

**Response:**
```json
{
  "success": true,
  "uploadUrl": "https://www.googleapis.com/upload/drive/v3/...",
  "folderLink": "https://drive.google.com/drive/folders/..."
}
```

**Google Drive Folder Structure:**
```
üìÇ GOOGLE_DRIVE_PARENT_FOLDER_ID
‚îî‚îÄ‚îÄ üìÇ ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 2567
    ‚îî‚îÄ‚îÄ üìÇ ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà 2
        ‚îî‚îÄ‚îÄ üìÇ ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°
            ‚îî‚îÄ‚îÄ üìÇ 67-12-22 ‡∏Å‡∏µ‡∏¨‡∏≤‡∏™‡∏µ 2567
                ‚îî‚îÄ‚îÄ üñº IMG_001.jpg
```

**lib/googleDrive.ts Functions:**
| Function | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|----------|----------|
| `getDriveClient()` | ‡∏™‡∏£‡πâ‡∏≤‡∏á OAuth2 client ‡∏à‡∏≤‡∏Å refresh token |
| `getOrCreateFolder(drive, parentId, folderName)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ) |
| `initiateResumableUpload(params)` | ‡πÄ‡∏£‡∏¥‡πà‡∏° resumable upload ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∑‡∏ô session URL |

**lib/academicYear.ts Functions:**
| Function | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|----------|----------|
| `getThaiAcademicYear(date)` | ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô |
| `getThaiMonthName(date)` | ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÑ‡∏ó‡∏¢ |
| `getThaiMonthNumber(date)` | ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡∏∑‡∏≠‡∏ô |

---

### üìò `/api/facebook/post` (POST) - Facebook Auto Post

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:** ‡πÉ‡∏ä‡πâ **URL-based upload** - Facebook ‡∏î‡∏∂‡∏á‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å Google Drive ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ú‡πà‡∏≤‡∏ô server)

**Request:**
```json
{
  "jobId": "photography_job_id",
  "caption": "‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏µ‡∏¨‡∏≤‡∏™‡∏µ 2567 üèÉ‚Äç‚ôÇÔ∏è",
  "photoUrls": [
    "https://drive.google.com/file/d/FILE_ID_1/view",
    "https://drive.google.com/file/d/FILE_ID_2/view"
  ]
}
```

**Response:**
```json
{
  "success": true,
  "postId": "PAGE_ID_POST_ID",
  "permalinkUrl": "https://www.facebook.com/permalink.php?story_fbid=..."
}
```

**‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô:**

1. **Single Photo (1 ‡∏£‡∏π‡∏õ):**
   - POST to `/PAGE_ID/photos` with `published=true`
   - ‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ö‡∏ô Timeline ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

2. **Multiple Photos (‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ):**
   - POST each to `/PAGE_ID/photos` with `published=false` (unpublished)
   - POST to `/PAGE_ID/feed` with `attached_media` array
   - ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô Album Post ‡∏ö‡∏ô Timeline

**URL Conversion:**
```
Input:  https://drive.google.com/file/d/FILE_ID/view?usp=sharing
Output: https://drive.google.com/uc?export=download&id=FILE_ID
```

**Firestore Update:**
```typescript
{
  facebookPostId: "PAGE_ID_POST_ID",
  facebookPermalink: "https://www.facebook.com/permalink.php?...",
  facebookPostedAt: Timestamp
}
```

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:**
- ‡∏†‡∏≤‡∏û‡πÉ‡∏ô Drive ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô **Public** ‡∏´‡∏£‡∏∑‡∏≠ **Anyone with link**
- ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏ô `photoUrls` = ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏ô‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏° Facebook
- Token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ 60 ‡∏ß‡∏±‡∏ô (‡πÉ‡∏ä‡πâ script refresh)

---

### `/api/line-webhook` (POST)
‡∏£‡∏±‡∏ö Webhook ‡∏à‡∏≤‡∏Å LINE

**Handles:**
- "Track Status" / "‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞" ‚Üí ‡πÅ‡∏™‡∏î‡∏á Flex Carousel ‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°

---

### `/api/notify-repair` (POST)
‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà

**Request:**
```json
{
  "requesterName": "...",
  "room": "...",
  "description": "...",
  "imageOneUrl": "...",
  "zone": "junior_high | senior_high",
  "ticketId": "..."
}
```

**Security:**
- ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á `x-api-key` header (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö server-to-server) ‡∏´‡∏£‡∏∑‡∏≠
- Request ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å same origin (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö client)

---

### `/api/notify-user` (POST)
‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡πÄ‡∏ä‡πà‡∏ô ‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à)

**Request:**
```json
{
  "email": "user@tesaban6.ac.th",
  "message": "..."
}
```

---

### `/api/line/push` (POST)
‡∏™‡πà‡∏á Push Message ‡πÑ‡∏õ‡∏¢‡∏±‡∏á LINE User

**Request:**
```json
{
  "to": "LINE_USER_ID",
  "messages": [{ "type": "text", "text": "..." }]
}
```

---

### `/api/line/login` (GET)
Redirect ‡πÑ‡∏õ LINE Login

---

### `/api/line/callback` (GET)
Handle LINE Login Callback

---

### `/api/send-otp` (POST) - NEW
‡∏™‡πà‡∏á OTP 6 ‡∏´‡∏•‡∏±‡∏Å‡πÑ‡∏õ‡∏¢‡∏±‡∏á email ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ú‡∏π‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ LINE

**Request:**
```json
{
  "email": "user@tesaban6.ac.th",
  "lineUserId": "U..."
}
```

**Response:**
```json
{
  "success": true,
  "message": "‡∏™‡πà‡∏á OTP ‡πÑ‡∏õ‡∏ó‡∏µ‡πà email ‡πÅ‡∏•‡πâ‡∏ß"
}
```

**Validation:**
- Email ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ `@tesaban6.ac.th`
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ LINE ID ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ

---

### `/api/verify-otp` (POST) - NEW
‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö OTP ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á account binding

**Request:**
```json
{
  "otp": "482719",
  "lineUserId": "U..."
}
```

**Response:**
```json
{
  "success": true,
  "displayName": "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ",
  "email": "user@tesaban6.ac.th"
}
```

**Constraints:**
- OTP ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ 5 ‡∏ô‡∏≤‡∏ó‡∏µ
- ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- ‡∏™‡∏£‡πâ‡∏≤‡∏á `line_bindings` doc ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï `users` collection

---

### `/api/facebook/post` (POST)
‡πÇ‡∏û‡∏™‡∏†‡∏≤‡∏û‡πÑ‡∏õ Facebook Page

**Request:**
```json
{
  "jobId": "photography_job_id",
  "caption": "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏û‡∏™",
  "photoUrls": [
    "https://drive.google.com/file/d/FILE_ID_1/view",
    "https://drive.google.com/file/d/FILE_ID_2/view"
  ]
}
```

**Response:**
```json
{
  "success": true,
  "postId": "PAGE_ID_POST_ID"
}
```

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:**
- ‡πÉ‡∏ä‡πâ URL-based upload (Facebook fetch ‡∏à‡∏≤‡∏Å Drive ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á)
- ‡∏†‡∏≤‡∏û‡πÉ‡∏ô Drive ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô Public ‡∏´‡∏£‡∏∑‡∏≠ Anyone with link
- ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏†‡∏≤‡∏û‡πÉ‡∏ô `photoUrls` = ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏ô‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏° Facebook

---

### `/api/auth/line-custom-token` (POST)
‡∏™‡∏£‡πâ‡∏≤‡∏á Firebase Custom Token ‡∏à‡∏≤‡∏Å LINE Token


---

## üíæ Database Schema (Firestore)

### Collection: `users`
```typescript
{
  uid: string;
  email: string;
  displayName: string;
  photoURL?: string;
  role: 'user' | 'technician' | 'moderator' | 'admin';
  isPhotographer?: boolean;
  responsibility?: 'junior_high' | 'senior_high' | 'all';
  lineUserId?: string;
  createdAt: Timestamp;
  updatedAt?: Timestamp;
}
```

### Collection: `repair_tickets`
```typescript
{
  requesterName: string;
  requesterEmail: string;
  position: string;
  phone: string;
  room: string;
  zone: 'junior_high' | 'senior_high' | 'common';
  description: string;
  images: string[];
  status: 'pending' | 'in_progress' | 'waiting_parts' | 'completed' | 'cancelled';
  technicianName?: string;
  technicianNote?: string;
  completionImage?: string;
  partsUsed?: { name: string; quantity: number; date: Timestamp; }[];
  createdAt: Timestamp;
  updatedAt: Timestamp;
}
```

### Collection: `bookings`
```typescript
{
  title: string;
  room: string;
  roomId?: string;
  roomName?: string;
  startTime: Timestamp;
  endTime: Timestamp;
  requesterName: string;
  requesterEmail?: string;
  department: string;
  position?: string;
  phoneNumber?: string;
  attendees?: number | string;
  description?: string;
  layout?: string;
  equipment?: string[];          // ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
  ownEquipment?: string;         // ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏°‡∏≤‡πÄ‡∏≠‡∏á
  attachments?: string[];        // ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö
  micCount?: string;             // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏°‡∏Ñ‡πå
  needsPhotographer?: boolean;   // ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  status: 'pending' | 'approved' | 'rejected' | 'cancelled';
  createdAt: Timestamp;
}
```

### Collection: `photography_jobs`
```typescript
{
  title: string;
  description?: string;
  location: string;
  startTime: Timestamp;
  endTime: Timestamp;
  assigneeIds: string[];        // Array of Photographer UIDs (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô)
  assigneeNames?: string[];     // Array of Photographer names
  requesterId: string;
  requestName?: string;
  status: 'assigned' | 'completed' | 'cancelled';
  driveLink?: string;
  coverImage?: string;
  createdAt: Timestamp;
  isManualEntry?: boolean;      // Flag ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
  bookingId?: string;           // Link ‡πÑ‡∏õ‡∏¢‡∏±‡∏á booking (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
  facebookPostId?: string;      // Facebook Post ID (NEW)
  facebookPostedAt?: Timestamp; // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÇ‡∏û‡∏™ Facebook (NEW)
}
```

### Collection: `products`
```typescript
{
  name: string;
  brand: string;
  model?: string;
  price: number;
  purchaseDate: Timestamp;
  warrantyInfo: string;
  location: string;
  imageUrl: string;
  stockId: string;
  status: 'available' | 'borrowed' | 'requisitioned' | 'maintenance';
  type?: 'unique' | 'bulk';
  quantity?: number;
  borrowedCount?: number;
  createdAt: Timestamp;
}
```

### Collection: `transactions`
```typescript
{
  productId: string;
  type: 'borrow' | 'requisition';
  transactionDate: Timestamp;
  returnDate?: Timestamp;
  actualReturnDate?: Timestamp;
  status: 'active' | 'completed';
  signatureUrl: string;
  userName: string;
  userRoom: string;
  userPhone?: string;
  userPosition?: string;
}
```

### Collection: `line_bindings`
```typescript
{
  // Document ID = LINE User ID
  uid: string;              // Firebase User ID
  email: string;
  displayName: string;
  linkedAt: Timestamp;
}
```

### Collection: `otp_codes` (NEW)
```typescript
{
  // Document ID = LINE User ID
  email: string;
  otp: string;              // 6-digit OTP
  createdAt: Timestamp;
  expiresAt: Timestamp;     // +5 minutes
  attempts: number;         // Max 3 attempts
}
```

### Collection: `feedbacks` (NEW)
```typescript
{
  details: string;               // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤/‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞
  timestamp: Timestamp;
  status: 'new' | 'reviewed';
  userAgent: string;             // Browser info (‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ)
}
```

### Collection: `activities`
```typescript
{
  action: LogAction;             // borrow, return, requisition, add, update, repair, etc.
  productName: string;
  userName: string;
  imageUrl?: string;
  details?: string;
  zone?: string;
  status?: string;
  signatureUrl?: string;
  timestamp: Timestamp;
}
```

### Collection: `stats` > Document: `inventory`
```typescript
{
  total: number;
  available: number;
  borrowed: number;
  maintenance: number;
}
```

---

## üîë Environment Variables

‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `.env.local` ‡∏ó‡∏µ‡πà root:

```bash
# Firebase Client
NEXT_PUBLIC_FIREBASE_API_KEY=
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=
NEXT_PUBLIC_FIREBASE_PROJECT_ID=
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=
NEXT_PUBLIC_FIREBASE_APP_ID=

# Firebase Admin (Server-side)
FIREBASE_ADMIN_PRIVATE_KEY=
FIREBASE_ADMIN_CLIENT_EMAIL=

# LINE
LINE_CHANNEL_ACCESS_TOKEN=
LINE_CHANNEL_SECRET=
LINE_TECHNICIAN_ID=           # Fallback technician LINE ID
NEXT_PUBLIC_LINE_LIFF_ID_REPAIR=
NEXT_PUBLIC_LINE_LIFF_ID_BOOKING=

# Google Drive (OAuth 2.0)
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REFRESH_TOKEN=
GOOGLE_DRIVE_PARENT_FOLDER_ID=

# Facebook (NEW)
FACEBOOK_APP_ID=
FACEBOOK_APP_SECRET=
FACEBOOK_PAGE_ID=
FACEBOOK_PAGE_ACCESS_TOKEN=     # 60-day token, ‡πÉ‡∏ä‡πâ script refresh

# Email OTP (NEW)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=noreply@tesaban6.ac.th
SMTP_PASS=                      # Gmail App Password (16 characters)

# App
NEXT_PUBLIC_APP_URL=https://crms6it.vercel.app

# API Security (NEW)
CRMS_API_SECRET_KEY=your_random_secret_key_here
```

---

## üöÄ ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠

### Run Development
```bash
npm run dev
# ‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏µ‡πà http://localhost:3000
```

### Build Production
```bash
npm run build
npm run start
```

### Deploy to Vercel
```bash
git push origin main
# Vercel ‡∏à‡∏∞ Auto Deploy
```

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Refresh Token ‡πÉ‡∏´‡∏°‡πà
‡∏ñ‡πâ‡∏≤ Refresh Token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏:
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Google Cloud Console
2. ‡∏™‡∏£‡πâ‡∏≤‡∏á OAuth 2.0 Client ID
3. ‡πÉ‡∏ä‡πâ OAuth Playground ‡∏´‡∏£‡∏∑‡∏≠ Script ‡πÄ‡∏û‡∏∑‡πà‡∏≠ Generate Refresh Token
4. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï `GOOGLE_REFRESH_TOKEN` ‡πÉ‡∏ô Vercel

---

## ‚ö†Ô∏è Known Issues & TODOs

### Known Issues
- [ ] Refresh Token ‡∏≠‡∏≤‡∏à‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ô‡∏≤‡∏ô (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Service Account ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
- [x] ~~‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Rate Limiting ‡∏ö‡∏ô API Routes~~ ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏° API Key check ‡πÅ‡∏•‡πâ‡∏ß
- [ ] ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Server-side Auth Check ‡∏ö‡∏ô `/api/drive/upload`

### Completed ‚úÖ
- [x] ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ Export ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô Excel (`utils/excelExport.ts`)
- [x] ‡πÄ‡∏û‡∏¥‡πà‡∏° Admin Dashboard ‡∏û‡∏£‡πâ‡∏≠‡∏° Activity Feed
- [x] ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡πÉ‡∏ô Photography Jobs
- [x] ‡πÄ‡∏û‡∏¥‡πà‡∏° Image Compression ‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
- [x] ‡πÄ‡∏û‡∏¥‡πà‡∏° User History Modal (‡∏ã‡πà‡∏≠‡∏°, ‡∏à‡∏≠‡∏á, ‡∏¢‡∏∑‡∏°, ‡πÄ‡∏ö‡∏¥‡∏Å)
- [x] ‡πÄ‡∏û‡∏¥‡πà‡∏° Report Issue Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Feedback
- [x] ‡πÄ‡∏û‡∏¥‡πà‡∏° Equipment Return Modal ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô
- [x] ‡πÄ‡∏û‡∏¥‡πà‡∏° Inventory Stats Aggregation
- [x] **Facebook Auto Post** - ‡πÇ‡∏û‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏õ Facebook Page
- [x] **‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏†‡∏≤‡∏û Facebook** - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÇ‡∏û‡∏™ (1, 2, 3...)
- [x] **Drive/Facebook Icons** - ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Dashboard ‡πÅ‡∏•‡∏∞ Gallery
- [x] **Token Refresh Script** - Script ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Refresh Facebook Token
- [x] **AI Agent (LINE Bot)** - ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ AI ‡πÉ‡∏ô LINE Bot ‡πÉ‡∏ä‡πâ Gemini 2.5 Flash
- [x] **AI Room Availability Check** - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏ú‡πà‡∏≤‡∏ô AI (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç field name `roomId`)
- [x] **Date Utilities (`lib/dateUtils.ts`)** - Bangkok Timezone handling ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
- [x] **FCM Push Notifications** - ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô Firebase Cloud Messaging
- [x] **Thai Date Format** - AI ‡∏ï‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ó‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô "21 ‡∏ò.‡∏Ñ. 2568")
- [x] **AI Context Management** - ‡∏à‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÑ‡∏î‡πâ 30 ‡∏ô‡∏≤‡∏ó‡∏µ
- [x] **Gallery Search Fix** - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç AI ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏π‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡∏•‡∏ö duplicate SYSTEM_PROMPT)
- [x] **Code Cleanup** - ‡∏•‡∏ö unused imports ‡πÅ‡∏•‡∏∞ interface fields
- [x] **API Security** - ‡πÄ‡∏û‡∏¥‡πà‡∏° API key check ‡πÉ‡∏ô `/api/notify-repair`
- [x] **Firestore Indexes** - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ `FIRESTORE_INDEXES.md`
- [x] **Room Schedule Format** - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°
- [x] **Firebase Admin SDK Migration** - ‡∏¢‡πâ‡∏≤‡∏¢ AI Agent ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ Admin SDK ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- [x] **OTP Account Binding** - ‡∏ú‡∏π‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ LINE ‡∏ú‡πà‡∏≤‡∏ô AI + Email OTP
- [x] **Zone Display** - ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏ã‡∏ô (‡∏°.‡∏ï‡πâ‡∏ô/‡∏°.‡∏õ‡∏•‡∏≤‡∏¢) ‡πÉ‡∏ô Repair Tickets ‡πÅ‡∏•‡∏∞ Flex Messages
- [x] **Signature Capture** - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà

### TODOs
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° PWA Support ‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° Report ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö Notification ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô
- [ ] Voice-to-Repair (‡∏™‡πà‡∏á voice message ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°)
- [ ] Proactive AI Notification (‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à)

---

## üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠

**‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤:** IT Department, Tessaban 6 School  
**Repository:** https://github.com/Khinkawu/crms6it

---

*‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏î‡∏¢ Antigravity AI ‡πÄ‡∏°‡∏∑‡πà‡∏≠ 24 ‡∏ò.‡∏Ñ. 2567 ‡πÄ‡∏ß‡∏•‡∏≤ 11:30 ‡∏ô.*
